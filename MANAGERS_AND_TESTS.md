# 🎮 Muscle & Blood: 매니저 및 테스트 개요

이 문서는 'Muscle & Blood' 게임의 주요 매니저들과 각 매니저를 테스트하는 방법에 대해 설명합니다.

---

## 🛠️ 게임 매니저 개요

'Muscle & Blood' 게임은 모듈화된 아키텍처를 기반으로 여러 매니저가 각자의 역할을 수행합니다.

### 핵심 시스템 매니저

* **`GameEngine`**: 게임의 모든 핵심 시스템과 매니저를 통합하고 관리하는 최상위 엔진입니다. 게임 루프를 실행하고, 모든 매니저의 업데이트 및 그리기를 조율합니다.
* **`GameLoop`**: 게임의 메인 루프를 담당하며, `_update`와 `_draw` 함수를 프레임마다 호출하여 게임 로직 업데이트와 화면 렌더링을 지속적으로 수행합니다.
* **`Renderer`**: HTML `<canvas>` 요소와 2D 렌더링 컨텍스트를 관리합니다. 화면을 지우고 배경을 그리는 등 기본적인 렌더링 작업을 처리합니다.

### 주요 기능 매니저

* **`EventManager`**: 게임 내에서 발생하는 모든 '사건'을 접수하고, 이를 구독자에게 전파하는 중앙 집중식 이벤트 시스템입니다. Web Worker를 활용하여 일부 이벤트 처리를 백그라운드에서 수행합니다.
* **`GuardianManager`**: 게임 데이터의 불변 규칙을 검증하는 '작은 엔진' 역할을 합니다. 유닛의 체력, 해상도 설정 등 중요한 게임 데이터가 미리 정의된 규칙을 준수하는지 확인합니다.
* **`MeasureManager`**: 게임 내의 모든 크기, 비율, 해상도 등 측정 관련 설정을 중앙에서 관리합니다. 다른 매니저들이 일관된 측정값을 참조하고 업데이트할 수 있도록 합니다.
* **`MapManager`**: 게임 월드의 맵 데이터, 그리드, 타일 크기 및 경로 탐색 로직을 관리합니다. `MeasureManager`를 통해 맵의 차원을 동적으로 재계산합니다.
* **`UIEngine`**: 게임의 사용자 인터페이스(UI) 요소를 관리하고 그립니다. 버튼, 패널 등 오버레이 UI를 담당하며, 사용자 입력(버튼 클릭)을 처리합니다.
* **`LayerEngine`**: 렌더링할 여러 레이어를 등록하고 관리합니다. 각 레이어의 `zIndex`에 따라 올바른 순서로 그려지도록 하여 복잡한 화면 구성을 가능하게 합니다.
* **`SceneManager`**: 게임의 다양한 '장면' 또는 '상태'(예: 영지 화면, 전투 화면)를 논리적으로 그룹화하고 관리합니다. 현재 활성화된 씬에 속한 매니저들을 업데이트하고 그리도록 지시합니다. **확대/축소 및 드래그 변환은 담당하지 않습니다.**
* **`CameraEngine`**: 게임 화면의 뷰포트를 관리합니다. 확대/축소(zoom) 및 이동(pan) 변환을 계산하고 캔버스 렌더링 컨텍스트에 적용합니다. `LogicManager`로부터 제약 조건을 받아 화면의 빈틈을 방지합니다.
* **`InputManager`**: 마우스 클릭, 드래그, 휠 스크롤 등 사용자 입력 이벤트를 감지하고 처리합니다. 이를 `CameraEngine`에 전달하여 화면 변환을 제어하며, UI 요소와의 충돌을 방지합니다.
* **`LogicManager`**: 게임의 핵심 논리적 규칙과 제약 조건을 정의합니다. 특히 카메라의 이동 및 줌 범위에 대한 제약 조건을 계산하여 `CameraEngine`에 제공함으로써, 화면에 빈틈이 생기지 않도록 보장합니다.
* **`CompatibilityManager`**: 게임이 다양한 화면 크기와 기기 방향(가로/세로)에 적응할 수 있도록 지원합니다. 뷰포트 변경 시 게임의 해상도를 동적으로 조정하여 콘텐츠가 잘리지 않도록 합니다.

---

## 🧪 테스트 개요

게임의 안정성과 기능성을 보장하기 위해 다양한 유형의 테스트를 수행합니다.

### 1. 단위 테스트 (Unit Tests)

* **목적**: 각 매니저 또는 모듈의 개별 기능이 예상대로 작동하는지 검증합니다. 종속성은 모의(mock) 객체로 대체하여 테스트 대상의 로직만 격리하여 테스트합니다.
* **테스트 대상 및 내용**:
    * **`RendererTests`**: 렌더러가 캔버스와 컨텍스트를 올바르게 초기화하는지 확인합니다.
    * **`GameLoopTests`**: 게임 루프가 시작/정지되고 `update`/`draw` 콜백을 올바르게 호출하는지 확인합니다.
    * **`EventManagerTests`**: 이벤트 구독, 발행, 전파가 올바르게 작동하며 Web Worker와의 통신이 원활한지 확인합니다.
    * **`GuardianManagerTests`**: 정의된 불변 규칙(예: 유닛 체력, 해상도)을 올바르게 강제하고 위반 시 오류를 발생시키는지 확인합니다.
    * **`MeasureManagerUnitTests`**: (아직 구현되지 않음) `MeasureManager`의 `get`/`set` 메서드가 측정값을 올바르게 반환하고 설정하는지 테스트할 예정입니다.
    * **`MapManagerUnitTests`**: (아직 구현되지 않음) `MapManager`가 맵을 생성하고 타일 데이터를 올바르게 반환하는지 테스트할 예정입니다.
    * **`UIEngineUnitTests`**: (아직 구현되지 않음) `UIEngine`이 UI 요소를 올바르게 계산하고 그리는지 테스트할 예정입니다.
    * **`SceneManagerUnitTests`**: 씬 등록 및 전환, 현재 씬의 매니저 업데이트 및 그리기가 올바르게 작동하는지 확인합니다.
    * **`LogicManagerUnitTests`**: `LogicManager`가 현재 씬의 콘텐츠 크기, 줌 제한, 팬 제약 조건을 올바르게 계산하고 반환하는지 확인합니다.
    * **`CompatibilityManagerUnitTests`**: `CompatibilityManager`가 다양한 뷰포트 크기와 비율에 맞춰 게임 해상도를 올바르게 조정하는지 확인합니다.

### 2. 결함 주입 테스트 (Fault Injection Tests)

* **목적**: 시스템의 특정 부분에 의도적으로 오류 또는 예외적인 상황을 주입하여, 해당 모듈이 이러한 상황을 얼마나 견고하게 처리하는지, 또는 예상대로 실패하는지 확인합니다.
* **테스트 대상 및 내용**:
    * **`RendererFaults`**: 렌더링 컨텍스트가 유효하지 않을 때 렌더러가 예상대로 오류를 처리하는지 시뮬레이션합니다.
    * **`GameLoopFaults`**: 게임 루프의 `update` 또는 `draw` 함수에서 의도적인 오류가 발생할 때 시스템의 반응을 테스트합니다.
    * **`EventManagerFaults`**: 이벤트 구독자 콜백에서 오류가 발생하거나 Web Worker가 종료된 후 이벤트를 발행할 때의 동작을 테스트합니다.
    * **`GuardianManagerFaults`**: 유효하지 않거나 누락된 게임 데이터를 `GuardianManager`에 전달했을 때 오류를 올바르게 발생시키는지 테스트합니다.
    * **`SceneManagerFaults`**: 존재하지 않는 씬으로 전환을 시도하거나, 씬이 설정되지 않은 상태에서 업데이트/그리기 호출 시 시스템의 반응을 테스트합니다.
    * **`LogicManagerFaults`**: `MeasureManager` 또는 `SceneManager`로부터 유효하지 않거나 누락된 데이터를 받았을 때 `LogicManager`가 어떻게 작동하는지(예: 경고 발행, 기본값 반환) 테스트합니다.
    * **`CompatibilityManagerFaults`**: `MeasureManager`나 `Renderer` 등의 종속성 메서드가 누락되거나 유효하지 않은 상태일 때 `CompatibilityManager`가 어떻게 동작하는지(예: 충돌 방지) 테스트합니다.

### 3. 통합 테스트 (Integration Tests)

* **목적**: 여러 매니저나 모듈이 함께 작동할 때 기능이 올바르게 수행되는지 검증합니다. 실제 게임 환경과 유사하게 구성하여 매니저 간의 상호작용을 테스트합니다.
* **테스트 대상 및 내용**:
    * **`MeasureManagerIntegrationTest`**: `MeasureManager`의 값이 변경될 때 `UIEngine`과 `MapManager`가 이를 올바르게 반영하여 자신들의 크기와 위치를 재조정하는지 확인합니다.

---

**테스트 실행 방법**:

1.  모든 변경 사항을 저장합니다.
2.  로컬 웹 서버(예: `python3 -m http.server 8000`)를 통해 게임을 실행합니다.
3.  브라우저에서 `http://localhost:8000/debug.html`에 접속합니다.
4.  화면 왼쪽 상단에 있는 디버그 패널에서 각 테스트에 해당하는 버튼을 클릭하여 콘솔에서 결과를 확인합니다.
